---
title: "Final_project"
author: "Shijie Qu & Yifan Song"
date: "12/1/2018"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
realEst_data = read.csv("ames_housing_data_PROJECT2018.csv")
library(tidyverse)
library(car)
library(GGally)
glimpse(data)
```

### AR-1
```{r}
ggpairs(data = realEst_data, columns = c ("SalePrice","LotArea","YearBuilt","SqFt"))
```

```{r}
## SalePrice vs LotArea

# take log of both
plot(log(realEst_data$LotArea),log(realEst_data$SalePrice),xlab = "log(LotArea)",ylab = "log(SalePrice)",main = "log(SalePrice) vs log(LotArea)")
lm1 = lm(log(SalePrice)~log(LotArea),data = realEst_data)
abline(lm1)
summary(lm1)
```

```{r}
## SalePrice vs YearBuilt

# take log of only SalePrice
plot(realEst_data$YearBuilt,log(realEst_data$SalePrice),xlab = "YearBuilt",ylab = "log(SalePrice)",main = "log(SalePrice) vs YearBuilt")
lm2 = lm(log(SalePrice)~YearBuilt,data = realEst_data)
abline(lm2)
summary(lm2)

# try quadratic model
lm2_1 = lm(log(SalePrice)~YearBuilt + I(YearBuilt^2),data = realEst_data);


plot(realEst_data$YearBuilt,log(realEst_data$SalePrice),xlab = "YearBuilt",ylab = "log(SalePrice)",main = "log(SalePrice) vs YearBuilt",col="red")
points(realEst_data$YearBuilt,fitted(lm2_1),col="blue");
```

```{r}
## SalePrice vs SqrFt

# take log of only SalePrice
plot(realEst_data$SqFt,log(realEst_data$SalePrice),xlab = "SqFt",ylab = "log(SalePrice)",main = "log(SalePrice) vs log(LotArea)")
lm3 = lm(log(SalePrice)~SqFt , data = realEst_data)
abline(lm3)
summary(lm3)
```

### AR-2
```{r}
## Build linear model
mod = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt,data = realEst_data)
summary(mod)

```

```{r}
##??Check interaction
newdata1 = subset(realEst_data, YearBuilt>=1960 & YearBuilt <= 1970)
newdata2 = subset(realEst_data, YearBuilt>=1975 & YearBuilt <= 1985)
newdata3 = subset(realEst_data, YearBuilt>=1990 & YearBuilt <= 2000)
plot(newdata1$SqFt, newdata1$SalePrice)
lm(newdata1$SalePrice~newdata1$SqFt)
plot(newdata2$SqFt, newdata2$SalePrice)
lm(newdata2$SalePrice~newdata2$SqFt)
plot(newdata3$SqFt, newdata3$SalePrice)
lm(newdata3$SalePrice~newdata3$SqFt)
```

```{r}
##???Check interaction
AIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:log(LotArea),data = realEst_data)) - AIC(mod)
BIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:log(LotArea),data = realEst_data)) - BIC(mod)
AIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:YearBuilt,data = realEst_data)) - AIC(mod)
BIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:YearBuilt,data = realEst_data)) - BIC(mod)
AIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+log(LotArea):YearBuilt,data = realEst_data)) - AIC(mod)
BIC(lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+log(LotArea):YearBuilt,data = realEst_data)) - BIC(mod)
anova(mod, lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:log(LotArea),data = realEst_data))
anova(mod, lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+SqFt:YearBuilt,data = realEst_data))
anova(mod, lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+log(LotArea):YearBuilt,data = realEst_data))
```

```{r}
##Residual plot and QQ-plot
plot(fitted(mod),resid(mod))
abline(h=0)
qqnorm(resid(mod));qqline(resid(mod))
```


### AR-3
```{r}
# determmine to use

HalfBath_Fact = as.factor(realEst_data$HalfBath)
FullBath_Fact = as.factor(realEst_data$FullBath)
Bedroom_Fact = as.factor(realEst_data$Bedrooms)
Room_Fact = as.factor(realEst_data$Rooms)


# decide rooms to be continuous or factored variable
roomFact = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+Room_Fact+Style,data = realEst_data)
roomCont = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+Rooms+Style,data = realEst_data)
diffRoom = BIC(roomFact) - BIC(roomCont)
diffRoom

# decide HalfBath to be continuous or factored variable
HalfBathFact = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+HalfBath_Fact+Style,data = realEst_data)
HalfBathCont = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+HalfBath+Style,data = realEst_data)
diffHalfBath = BIC(HalfBathFact) - BIC(HalfBathCont)
diffHalfBath

# decide FullBath to be continuous or factored variable
FullBathFact = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+FullBath_Fact+Style,data = realEst_data)
FullBathCont = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+FullBath+Style,data = realEst_data)
diffFullBath = BIC(FullBathFact) - BIC(FullBathCont)
diffFullBath

# decide Bedrooms to be continuous or factored variable
BedroomsFact = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+Bedroom_Fact+Style,data = realEst_data)
BedroomsCont = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+Bedrooms+Style,data = realEst_data)
diffBedrooms = BIC(BedroomsFact) - BIC(BedroomsCont)
diffBedrooms

# decide whether should replace Rooms as a predictor
WithRooms = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+HalfBath_Fact+FullBath_Fact+Bedroom_Fact+Room_Fact+Style,data = realEst_data)
NoRooms = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+HalfBath_Fact+FullBath_Fact+Bedroom_Fact+Style,data = realEst_data)
diffR = BIC(WithRooms) - BIC(NoRooms)
diffR




## therefore, use factored value & with rooms


```

```{r}

# stepwise regression by AIC
null = lm(log(SalePrice)~1, data = realEst_data )
full = lm(log(SalePrice)~SqFt+log(LotArea)+YearBuilt+HalfBath+FullBath+Bedroom_Fact+Room_Fact+Style,data = realEst_data)

library(MASS)
stepAIC(full,scope = list(lower=null,upper=full),direction="both",k=log(dim(realEst_data)[1]));



```


```{r}
newlm = stepAIC(null,scope = list(upper=full),direction="both",k=log(dim(realEst_data)[1]));
newlm$terms
```


```{r}
##Residual plot and QQ-plot
plot(newlm$fitted.values,newlm$residuals)
abline(h=0)
qqnorm(newlm$residuals);qqline(newlm$residuals)
```